-- Function to handle chat commands
local function onChatMessage(player, message)
    local command, arg = message:match("^(%S+)%s*(.*)")

    if command == "!teleport" then
        -- Execute teleport command
        print(player.Name .. " wants to teleport to " .. arg)
        local targetPlayer = nil
        arg = arg:lower()

        for _, p in ipairs(game.Players:GetPlayers()) do
            if p.Name:lower():sub(1, #arg) == arg then
                targetPlayer = p
                break
            end
        end

        if targetPlayer and targetPlayer.Character then
            local targetCharacter = targetPlayer.Character
            local character = player.Character
            if character then
                local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                local targetHumanoidRootPart = targetCharacter:FindFirstChild("HumanoidRootPart")
                if humanoidRootPart and targetHumanoidRootPart then
                    humanoidRootPart.CFrame = targetHumanoidRootPart.CFrame
                end
            end
        end

    elseif command == "!esp" then
        -- Execute ESP command
        print(player.Name .. " wants to enable ESP.")
        for _, targetPlayer in ipairs(game.Players:GetPlayers()) do
            if targetPlayer.Character then
                addESPToCharacter(targetPlayer.Character)
            end
        end

    elseif command == "!knock" then
        -- Execute knock command
        print(player.Name .. " wants to knock " .. arg)
        local targetPlayer = nil
        arg = arg:lower()

        for _, p in ipairs(game.Players:GetPlayers()) do
            if p.Name:lower() == arg then
                targetPlayer = p
                break
            end
        end

        if targetPlayer and targetPlayer.Character then
            local character = player.Character
            local targetCharacter = targetPlayer.Character

            if character and targetCharacter then
                -- Equip the combat tool if not equipped
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    local combatTool = character:FindFirstChild("Combat") -- Correct tool name here
                    if combatTool and combatTool.Parent == nil then
                        combatTool.Parent = character:FindFirstChildOfClass("Backpack")
                    end

                    -- Equip the combat tool
                    if combatTool then
                        humanoid:EquipTool(combatTool)

                        -- Move to the target
                        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                        local targetHumanoidRootPart = targetCharacter:FindFirstChild("HumanoidRootPart")
                        if humanoidRootPart and targetHumanoidRootPart then
                            humanoidRootPart.CFrame = targetHumanoidRootPart.CFrame

                            -- Perform knock action (Placeholder logic)
                            wait(0.5) -- Wait for the combat tool to be equipped
                            -- Add knock action logic here, e.g., simulate attack or use combat tool
                        end
                    end
                end
            end
        else
            print("Player not found or target has no character.")
        end

    elseif command == "!unknock" then
        -- Stop knocking
        print(player.Name .. " stopped knocking.")

    elseif command == "!autostomp" then
        -- Execute autostomp command
        print(player.Name .. " wants to autostomp.")
        -- Add autostomp logic here

    elseif command == "!unautostomp" then
        -- Stop autostomp
        print(player.Name .. " stopped autostomping.")

    elseif command == "!view" then
        -- Execute view command
        print(player.Name .. " wants to view " .. arg)
        local targetPlayer = nil
        arg = arg:lower()

        for _, p in ipairs(game.Players:GetPlayers()) do
            if p.Name:lower():sub(1, #arg) == arg then
                targetPlayer = p
                break
            end
        end

        if targetPlayer and targetPlayer.Character then
            -- Viewing logic here
            local targetCharacter = targetPlayer.Character
            if targetCharacter then
                game.Workspace.CurrentCamera.CameraSubject = targetCharacter:FindFirstChild("Humanoid") or targetCharacter
            end
        end

    elseif command == "!unview" then
        -- Stop viewing
        print(player.Name .. " stopped viewing.")
        game.Workspace.CurrentCamera.CameraSubject = player.Character
    end
end
